<?php 
if (!isset($_SESSION)) {
  session_start();
}
require('fpdf.php');
require_once '../lib/config.php';
require_once '../lib/common.php';

include('numerosALetras.class.php');

class PDF extends FPDF
{

//Cabecera de página
function Header()
{
        $var_izquierda='../imagenes/izquierda.jpg';
	$var_centro='../imagenes/centro.jpg';
	$var_derecha='../imagenes/derecha.jpg';
	
        $this->SetFont("Arial","B",12);
     	$this->Image($var_izquierda,10,8,100,30);
	$this->Image($var_centro,115,8,45,20);
	$this->Image($var_derecha,158,8,30,20);
     	$this->Ln(30);

}




function detalle(){

		$conexion=conexion();
	$conOCS = 'select * from nomempresa';
	$resOCS = query($conOCS,$conexion);
	$filaOCS = fetch_array($resOCS);
	$RRHH = $filaOCS['ger_rrhh'];

	

	$registro_id=$_GET[registro_id];
	$tipo=$_GET[tipN];
	$esta=$_GET[est];
	$query="select * from nompersonal where ficha = '$registro_id' and tipnom='$tipo'";
	$resultado = query($query,$conexion);
	$personal = fetch_array($resultado);
	
	
	
	
	
	
	$persona=$personal['apenom'];
	$cedula=$personal['cedula'];
	$fechaini=$personal['fecing'];

	list($anio,$mes,$dia)=explode("-",$fechaini);
   	$fechaini= $dia."/".$mes."/".$anio; 

	$fechasus=$personal['fechasus'];

	list($anio,$mes,$dia)=explode("-",$fechasus);
   	$fechafsus= $dia."/".$mes."/".$anio; 
	
	$id_cargo=$personal['codcargo'];
	$query="select * from nomcargos where cod_car = '$id_cargo'";
	$resultado1 = query($query,$conexion);
	$cargo = fetch_array($resultado1);
	$cargo=$cargo['des_car'];

	$id_gerencia=$personal['codnivel4'];
	$query="select * from nomnivel4 where codorg = '$id_gerencia'";
	$resultado2 = query($query,$conexion);
	$ger = fetch_array($resultado2);
	$gerencia=$ger['descrip'];
	
	$monto=$personal['suesal'];
	
	$ficha=$personal['ficha'];
	
	$query="select * from nomcampos_adic_personal where ficha = '$ficha' and tiponom='$tipo'";
	$resultado3 = query($query,$conexion);
		
	$n = new numerosALetras();
	$salarioletras=$n->convertir($monto);

	
	$salario=number_format($monto,2,',','.');
	


	
	$this->Ln(10);
	$this->SetFont('Arial','B',12);
	$this->Cell(188,7,'CONSTANCIA',0,0,'C');
	$this->Ln(20);
	$this->SetFont('Arial','I',12);
	$contenido='     Quien suscribe, Gerente General de Recursos Humanos, hace constar por medio de la presente que la cuidadana '.$persona.', titular de la Cédula de Identidad Nº '.$cedula.', laboró para esta Empresa desde el '.$fechaini.', siendo jubilado a partir del '.$fechasus.', con el cargo de '.$cargo.', devegando actualmente una pensión mensual de '.$salarioletras.' (Bs. F. '.$salario.').';

	$n = new numerosALetras();
	$dialetra=$n->convertirdia(date('d'));
	$añoletra=$n->convertirdia(date('Y'));

	$subcontenido='     Constancia que se expide a petición de la parte interesada, en Caracas a los '.$dialetra.' ('.date('d').') días del mes de '.mesaletras(date('m')).' del año '.$añoletra.' ('.date('Y').').';
	$this->Cell(10,7,'',0,0);
	$this->MultiCell(168,10,utf8_decode($contenido),0,'J');
	$this->Ln(10);
	$this->Cell(10,7,'',0,0);
	$this->MultiCell(168,10,utf8_decode($subcontenido),0,'J');
	$this->SetFont('Arial','B',12);
	$this->Ln(35);
	$this->Cell(188,7,$RRHH,0,0,'C');
	$this->Ln();
	$this->SetY(-38);
	$this->SetFont('Arial','I',8);
	$this->Cell(188,10,'Elaborado Por: '.$_SESSION['nombre'],0,0,'L');
	
}

function Footer(){
	$Conn=conexion();
	$var_sql="select * from nomempresa";
	$rs = query($var_sql,$Conn);
	$row_rs = fetch_array($rs);
	$direccion=$row_rs['dir_emp'];
	$codigo=$row_rs['zon_emp'];
	$ciudad=$row_rs['ciu_emp'];
	$this->Cell(188,8,'','B',0);
	
}
}
//Creación del objeto de la clase heredada
$pdf=new PDF();
$pdf->AliasNbPages();
$pdf->AddPage();
$pdf->SetFont('Times','',12);

	$pdf->detalle();
$pdf->Output();
?>